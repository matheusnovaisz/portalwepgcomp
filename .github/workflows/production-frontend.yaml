name: Deploy Frontend

on:
  push:
    branches: [ master ]
    paths:
      - 'frontend/**'
      - '.github/workflows/production-frontend.yaml'
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: production
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: Setup SSH
      run: |
        mkdir -p ~/.ssh
        echo "${{ secrets.DOKKU_SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
        chmod 600 ~/.ssh/id_rsa
        ssh-keyscan -H ${{ secrets.DOKKU_HOST }} >> ~/.ssh/known_hosts
    
    - name: Start SSH agent and add key
      run: |
        eval "$(ssh-agent -s)"
        ssh-add ~/.ssh/id_rsa
    
    - name: Deploy Frontend to Dokku
      run: |
        echo "ðŸš€ Deploying frontend application..."
        git remote add dokku-front dokku@${{ secrets.DOKKU_HOST }}:${{ secrets.DOKKU_FRONT_APP_NAME }}
        git push dokku-front master
    
    - name: Deployment success
      run: |
        echo "âœ… Frontend deployment completed successfully!"
        echo "App: ${{ secrets.DOKKU_FRONT_APP_NAME }}"
        if [ -n "${{ secrets.FRONTEND_URL }}" ]; then
          echo "URL: ${{ secrets.FRONTEND_URL }}"
        fi